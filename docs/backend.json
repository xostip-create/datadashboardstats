{
  "entities": {
    "Item": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Item",
      "type": "object",
      "description": "Represents an item sold at the bar.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the item."
        },
        "name": {
          "type": "string",
          "description": "Name of the item."
        },
        "unitPrice": {
          "type": "number",
          "description": "The unit price of the item."
        }
      },
      "required": [
        "id",
        "name",
        "unitPrice"
      ]
    },
    "Sale": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Sale",
      "type": "object",
      "description": "Represents a single sale transaction.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the sale."
        },
        "itemId": {
          "type": "string",
          "description": "Reference to Item. (Relationship: Item 1:N Sale)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the item sold."
        },
        "saleDate": {
          "type": "string",
          "description": "The date of the sale.",
          "format": "date"
        }
      },
      "required": [
        "id",
        "itemId",
        "quantity",
        "saleDate"
      ]
    },
    "StockLevel": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "StockLevel",
      "type": "object",
      "description": "Represents the stock level of an item.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the stock level entry."
        },
        "itemId": {
          "type": "string",
          "description": "Reference to Item. (Relationship: Item 1:N StockLevel)"
        },
        "quantity": {
          "type": "number",
          "description": "The stock quantity for the item."
        }
      },
      "required": [
        "id",
        "itemId",
        "quantity"
      ]
    },
    "Shortage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Shortage",
      "type": "object",
      "description": "Represents a staff shortage record.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the shortage record."
        },
        "staffName": {
          "type": "string",
          "description": "Name of the staff member with the shortage."
        },
        "amount": {
          "type": "number",
          "description": "The shortage amount."
        },
        "shortageDate": {
          "type": "string",
          "description": "The date of the shortage.",
          "format": "date"
        }
      },
      "required": [
        "id",
        "staffName",
        "amount",
        "shortageDate"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/items/{itemId}",
        "definition": {
          "entityName": "Item",
          "schema": {
            "$ref": "#/backend/entities/Item"
          },
          "description": "Stores item definitions.",
          "params": [
            {
              "name": "itemId",
              "description": "The unique identifier of the item."
            }
          ]
        }
      },
      {
        "path": "/sales/{saleId}",
        "definition": {
          "entityName": "Sale",
          "schema": {
            "$ref": "#/backend/entities/Sale"
          },
          "description": "Stores sale records.",
          "params": [
            {
              "name": "saleId",
              "description": "The unique identifier of the sale record."
            }
          ]
        }
      },
      {
        "path": "/stockLevels/{stockLevelId}",
        "definition": {
          "entityName": "StockLevel",
          "schema": {
            "$ref": "#/backend/entities/StockLevel"
          },
          "description": "Stores stock level records.",
          "params": [
            {
              "name": "stockLevelId",
              "description": "The unique identifier of the stock level record."
            }
          ]
        }
      },
      {
        "path": "/shortages/{shortageId}",
        "definition": {
          "entityName": "Shortage",
          "schema": {
            "$ref": "#/backend/entities/Shortage"
          },
          "description": "Stores staff shortage records.",
          "params": [
            {
              "name": "shortageId",
              "description": "The unique identifier of the shortage record."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to optimize for the BarBook application's core features: Sales Logging, Opening/Closing Stock Input, and Sales Summaries. It prioritizes authorization independence, clarity, and scalability.\n\n*   `/items`: Stores item definitions. This collection has a homogeneous security posture (admin only).\n*   `/sales/{saleId}`: Stores sale records.  Data is stored without nested data and adheres to the principle of Structural Segregation, as access to sales data is uniform.\n*   `/stockLevels/{stockLevelId}`: Stores stock level records.  Data is stored without nested data and adheres to the principle of Structural Segregation, as access to stock level data is uniform.\n\nThis structure supports the QAPs because `list` operations on each of the collections are secure, and authorization is managed via secure rules.\n\nAuthorization Independence:\n\n*   The structure avoids `get()` calls in security rules, crucial for atomic operations. There are no hierarchical authorizations (e.g., a `sale` document's access depending on an `item`'s attributes)."
  }
}